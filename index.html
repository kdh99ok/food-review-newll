<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í•™êµ ì• ë§›ì§‘ í‰ê°€</title>

  <!-- ğŸ’— ê¸°ë³¸ ìŠ¤íƒ€ì¼ -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: linear-gradient(to bottom, #fff5f7 0%, #ffe8f0 100%);
      padding: 20px;
      min-height: 100vh;
    }
    .container { max-width: 900px; margin: 0 auto; }
    header {
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
      color: #fff; padding: 30px; border-radius: 15px;
      text-align: center; margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    h1 { font-size: 28px; margin-bottom: 10px; }
    .subtitle { font-size: 14px; opacity: 0.9; }
    .status-badge { display:inline-block; padding:5px 15px; border-radius:20px; font-size:12px; margin-top:10px; font-weight:bold; }
    .badge-cloud { background:#d4edda; color:#155724; }
    .badge-local { background:#fff3cd; color:#856404; }
    .search-section {
      background:white; padding:25px; border-radius:12px; margin-bottom:20px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    .search-box { display:flex; gap:10px; margin-bottom:15px; }
    .search-input {
      flex:1; padding:12px 15px; border:2px solid #ffd1dc;
      border-radius:8px; font-size:16px;
    }
    .search-btn {
      background:linear-gradient(135deg, #ff6b9d 0%, #ffa8c5 100%);
      color:white; border:none; padding:12px 30px; border-radius:8px;
      cursor:pointer; font-size:16px; font-weight:bold; transition:all 0.2s;
    }
    .search-btn:hover { transform:translateY(-2px); box-shadow:0 4px 8px rgba(255,107,157,0.4); }
    .search-info { font-size:13px; color:#999; margin-top:10px; }
    .search-results {
      display:none; background:#fff0f5; padding:20px; border-radius:8px; margin-top:15px;
      max-height:400px; overflow-y:auto;
    }
    .search-result-item {
      background:white; padding:15px; border-radius:8px; margin-bottom:10px;
      border:1px solid #ffd1dc;
    }
    .restaurant-list { display:grid; gap:20px; }
    .restaurant-card {
      background:white; border-radius:12px; padding:20px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      transition:transform 0.2s, box-shadow 0.2s;
    }
    .restaurant-card:hover { transform:translateY(-5px); box-shadow:0 4px 12px rgba(0,0,0,0.15); }
    .restaurant-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .restaurant-name { font-size:22px; font-weight:bold; color:#333; }
    .average-rating { font-size:24px; color:#ff69b4; font-weight:bold; }
    .restaurant-info { color:#666; font-size:14px; margin-bottom:15px; }
    .view-reviews-btn {
      background:linear-gradient(135deg, #ff6b9d 0%, #ffa8c5 100%);
      color:white; border:none; padding:10px 20px; border-radius:8px;
      cursor:pointer; font-size:14px; transition:all 0.2s;
      box-shadow:0 2px 4px rgba(255,107,157,0.3);
    }
    .view-reviews-btn:hover { transform:translateY(-2px); }
    .loading { text-align:center; padding:20px; color:#ff69b4; }
    #map { width:100%; height:400px; border-radius:12px; margin-top:20px; }
  </style>

  <!-- ğŸ—ºï¸ ì¹´ì¹´ì˜¤ JavaScript ì§€ë„ SDK (ì—¬ê¸° ë³¸ì¸ í‚¤ ì ìš©ë¨) -->
  <script type="text/javascript"
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=3d4a62c7377cf992bde64869264c4c3c&libraries=services"></script>

  <!-- ğŸ”¥ Firebase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/firebase@9.22.0/compat/firebase-app.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/firebase@9.22.0/compat/firebase-database.min.js"></script>
</head>

<body>
  <div class="container">
    <header>
      <h1>ğŸ• í•™êµ ì• ë§›ì§‘ í‰ê°€</h1>
      <p class="subtitle">ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ìŒì‹ì ì„ ì°¾ê³  í‰ê°€í•˜ì„¸ìš”!</p>
      <div id="statusBadge"></div>
    </header>

    <div class="search-section">
      <h2 style="margin-bottom:15px; color:#333;">ğŸ” ìŒì‹ì  ì¶”ê°€í•˜ê¸°</h2>
      <div class="search-box">
        <input type="text" id="searchInput" class="search-input" placeholder="ì˜ˆ: í•™êµ ì• ë–¡ë³¶ì´, ê°•ë‚¨ì—­ ì¹´í˜">
        <button class="search-btn" onclick="searchRestaurants()">ê²€ìƒ‰</button>
      </div>
      <div class="search-info">ğŸ’¡ ì¹´ì¹´ì˜¤ë§µì—ì„œ ì‹¤ì œ ìŒì‹ì ì„ ê²€ìƒ‰í•´ì„œ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”!</div>
      <div id="searchResults" class="search-results"></div>
    </div>

    <div class="restaurant-list" id="restaurantList">
      <div class="loading">ì´ˆê¸°í™” ì¤‘...</div>
    </div>

    <!-- ì§€ë„ í‘œì‹œ ì˜ì—­ -->
    <div id="map"></div>
  </div>

  <script>
    const KAKAO_API_KEY = 'ebbc6cf924b2fc97e4dece0459bc5610';
    const firebaseConfig = {
      apiKey: "AIzaSyDPReXpWPf5YrIhicxsaBJN-hiyncOzHOk",
      authDomain: "food-review-74ce5.firebaseapp.com",
      databaseURL: "https://food-review-74ce5-default-rtdb.firebaseio.com",
      projectId: "food-review-74ce5",
      storageBucket: "food-review-74ce5.firebasestorage.app",
      messagingSenderId: "77234290897",
      appId: "1:77234290897:web:836d1822d1961bd32305f0"
    };

    let useFirebase = false;
    let database = null;

    function getLocalData(key) {
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : {};
    }

    function saveLocalData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    async function tryInitFirebase() {
      return new Promise((resolve) => {
        const timeout = setTimeout(() => { resolve(false); }, 4000);
        try {
          firebase.initializeApp(firebaseConfig);
          database = firebase.database();
          database.ref('.info/connected').once('value', (snapshot) => {
            clearTimeout(timeout);
            resolve(snapshot.val() === true);
          }, () => { clearTimeout(timeout); resolve(false); });
        } catch { clearTimeout(timeout); resolve(false); }
      });
    }

    window.addEventListener('load', async function() {
      useFirebase = await tryInitFirebase();
      const badge = document.getElementById('statusBadge');
      if (useFirebase) badge.innerHTML = '<span class="status-badge badge-cloud">â˜ï¸ í´ë¼ìš°ë“œ ëª¨ë“œ</span>';
      else badge.innerHTML = '<span class="status-badge badge-local">ğŸ’¾ ë¡œì»¬ ëª¨ë“œ</span>';
      loadRestaurants();
    });

    async function searchRestaurants() {
      const query = document.getElementById('searchInput').value.trim();
      const resultsDiv = document.getElementById('searchResults');
      if (!query) return alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = '<div class="loading">ê²€ìƒ‰ ì¤‘...</div>';

      try {
        const response = await fetch(`https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(query)}`, {
          headers: { 'Authorization': `KakaoAK ${KAKAO_API_KEY}` }
        });
        const data = await response.json();
        if (data.documents.length === 0) {
          resultsDiv.innerHTML = '<div class="loading">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        resultsDiv.innerHTML = '';
        data.documents.forEach(place => {
          const restaurantData = {
            name: place.place_name,
            address: place.address_name || place.road_address_name,
            phone: place.phone || 'ì •ë³´ ì—†ìŒ',
            category: place.category_name.split(' > ').pop(),
            lat: place.y,
            lng: place.x
          };

          const div = document.createElement('div');
          div.className = 'search-result-item';
          div.innerHTML = `
            <h3>${restaurantData.name}</h3>
            <p>ğŸ“ ${restaurantData.address}</p>
            <p>ğŸ“ ${restaurantData.phone}</p>
            <p>ğŸ·ï¸ ${restaurantData.category}</p>
            <button class="search-btn" onclick='addRestaurant(${JSON.stringify(restaurantData)})'>ìŒì‹ì  ì¶”ê°€</button>
            <button class="search-btn" style="background:#ffa8c5" onclick='showMap(${restaurantData.lat}, ${restaurantData.lng}, "${restaurantData.name}")'>ì§€ë„ë³´ê¸°</button>
          `;
          resultsDiv.appendChild(div);
        });
      } catch (e) {
        resultsDiv.innerHTML = '<div class="loading">API ìš”ì²­ ì˜¤ë¥˜</div>';
      }
    }

    function addRestaurant(data) {
      if (useFirebase) {
        database.ref('restaurants').push(data);
      } else {
        const restaurants = getLocalData('restaurants');
        const id = 'r_' + Date.now();
        restaurants[id] = data;
        saveLocalData('restaurants', restaurants);
      }
      alert('ìŒì‹ì ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
      document.getElementById('searchResults').style.display = 'none';
      loadRestaurants();
    }

    function loadRestaurants() {
      const list = document.getElementById('restaurantList');
      list.innerHTML = '';
      const restaurants = getLocalData('restaurants');
      const ids = Object.keys(restaurants);
      if (ids.length === 0) {
        list.innerHTML = '<div class="loading">ë“±ë¡ëœ ìŒì‹ì ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      ids.forEach(id => {
        const r = restaurants[id];
        const card = document.createElement('div');
        card.className = 'restaurant-card';
        card.innerHTML = `
          <div class="restaurant-header">
            <div class="restaurant-name">${r.name}</div>
          </div>
          <div class="restaurant-info">
            ğŸ“ ${r.address} | ğŸ“ ${r.phone} | ğŸ½ï¸ ${r.category}
          </div>
          <button class="view-reviews-btn" onclick='showMap(${r.lat}, ${r.lng}, "${r.name}")'>ì§€ë„ë³´ê¸°</button>
        `;
        list.appendChild(card);
      });
    }

    // âœ… ì§€ë„ í‘œì‹œ í•¨ìˆ˜
    function showMap(lat, lng, name) {
      const container = document.getElementById('map');
      const options = {
        center: new kakao.maps.LatLng(lat, lng),
        level: 3
      };
      const map = new kakao.maps.Map(container, options);
      const marker = new kakao.maps.Marker({
        position: new kakao.maps.LatLng(lat, lng)
      });
      marker.setMap(map);

      const infowindow = new kakao.maps.InfoWindow({
        content: `<div style="padding:5px;font-size:13px;">${name}</div>`
      });
      infowindow.open(map, marker);
    }

    document.getElementById('searchInput').addEventListener('keypress', (e)=>{
      if(e.key==='Enter') searchRestaurants();
    });
  </script>
</body>
</html>
